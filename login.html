<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Happy Paws Training</title>
    <meta
      name="description"
      content="Login to Happy Paws Training - Access your customer, trainer, or admin portal."
    />
    <!-- Tailwind via CDN for this static page only -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }
      .error-message {
        display: none;
        color: #ef4444;
        font-size: 13px;
        margin-top: 6px;
      }
      .error-message.show {
        display: block;
      }
      .form-input.error {
        border-color: #ef4444;
        background: #fef2f2;
      }
      .role-option.selected {
        background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
        color: white;
        border-color: #0ea5e9;
      }
      .admin-credentials-box {
        display: none;
        background: #fef3c7;
        border: 1px solid #fbbf24;
        border-radius: 8px;
        padding: 10px 12px;
        margin-bottom: 12px;
        font-size: 12px;
      }
      .admin-credentials-box.show {
        display: block;
      }
      .login-button.loading {
        position: relative;
        color: transparent;
      }
      .login-button.loading::after {
        content: "";
        position: absolute;
        width: 20px;
        height: 20px;
        top: 50%;
        left: 50%;
        margin-left: -10px;
        margin-top: -10px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body class="min-h-screen bg-slate-50 text-slate-900 antialiased">
    <header
      class="border-b bg-white/80 backdrop-blur sticky top-0 z-20 shadow-sm"
    >
      <div
        class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between"
      >
        <div class="flex items-center gap-2">
          <div
            class="h-9 w-9 rounded-full bg-sky-100 flex items-center justify-center"
          >
            <span class="text-sky-600 text-xl font-black">HP</span>
          </div>
          <div>
            <div class="text-lg font-semibold tracking-tight">
              Happy Paws Training
            </div>
            <p class="text-xs text-slate-500">
              Book classes &amp; private training with ease
            </p>
          </div>
        </div>
        <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
          <a href="index.html" class="text-slate-700 hover:text-sky-600">Home</a>
          <a
            href="customer.html"
            class="text-slate-700 hover:text-sky-600"
            >Customer Portal</a
          >
          <a
            href="trainer.html"
            class="text-slate-700 hover:text-sky-600"
            >Trainer Portal</a
          >
        </nav>
        <div class="flex items-center gap-3">
          <a
            href="login.html"
            class="text-sm font-medium text-sky-600 font-semibold"
            >Log in</a
          >
          <a
            href="register.html"
            class="inline-flex items-center rounded-full bg-sky-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-sky-700"
          >
            Get started
          </a>
        </div>
      </div>
    </header>

    <main class="flex-1 flex items-center justify-center min-h-[calc(100vh-200px)] py-10 px-4">
      <div class="w-full max-w-md">
        <div class="bg-white rounded-2xl shadow-lg p-8 space-y-6">
          <div class="text-center mb-6">
            <div class="text-3xl font-bold bg-gradient-to-r from-sky-600 to-blue-600 bg-clip-text text-transparent mb-2">
              üêæ Happy Paws
            </div>
            <div class="text-sm text-slate-500">Training & Pet Care</div>
          </div>

          <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-3 text-sm text-emerald-800 hidden" id="successMessage">
            Login successful! Redirecting...
          </div>

          <form id="loginForm" class="space-y-5">
            <!-- Admin Credentials Card -->
            <div class="admin-credentials-box" id="adminCredentialsBox">
              <div class="flex items-center justify-between gap-2 flex-wrap">
                <div class="font-semibold text-amber-900">Admin Login:</div>
                <div class="flex gap-3 flex-wrap">
                  <div class="flex items-center gap-2">
                    <span class="text-amber-900 font-medium text-xs">Email:</span>
                    <span class="font-mono bg-white px-2 py-1 rounded border border-amber-300 text-xs font-semibold" id="adminEmailDisplay">admin@hpt.com</span>
                    <button type="button" class="bg-amber-500 text-white px-2 py-1 rounded text-xs font-semibold hover:bg-amber-600" onclick="copyToClipboard('admin@hpt.com', this)">Copy</button>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-amber-900 font-medium text-xs">Pass:</span>
                    <span class="font-mono bg-white px-2 py-1 rounded border border-amber-300 text-xs font-semibold" id="adminPasswordDisplay">Admin123!</span>
                    <button type="button" class="bg-amber-500 text-white px-2 py-1 rounded text-xs font-semibold hover:bg-amber-600" onclick="copyToClipboard('Admin123!', this)">Copy</button>
                  </div>
                </div>
              </div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2" for="email">Email Address</label>
              <input
                type="email"
                id="email"
                class="form-input w-full px-4 py-3 border-2 border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition-all"
                placeholder="you@example.com"
                required
                autocomplete="email"
              />
              <div class="error-message" id="emailError"></div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2" for="password">Password</label>
              <div class="relative">
                <input
                  type="password"
                  id="password"
                  class="form-input w-full px-4 py-3 pr-12 border-2 border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition-all"
                  placeholder="Enter your password"
                  required
                  autocomplete="current-password"
                />
                <button
                  type="button"
                  class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-sky-600 text-lg"
                  id="passwordToggle"
                  aria-label="Toggle password visibility"
                >
                  üëÅÔ∏è
                </button>
              </div>
              <div class="error-message" id="passwordError"></div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Login As</label>
              <div class="grid grid-cols-3 gap-2">
                <div class="role-option px-4 py-3 border-2 border-slate-200 rounded-lg bg-slate-50 text-center text-sm font-medium text-slate-600 cursor-pointer transition-all hover:border-sky-300 hover:bg-sky-50 selected" data-role="customer">Customer</div>
                <div class="role-option px-4 py-3 border-2 border-slate-200 rounded-lg bg-slate-50 text-center text-sm font-medium text-slate-600 cursor-pointer transition-all hover:border-sky-300 hover:bg-sky-50" data-role="trainer">Trainer</div>
                <div class="role-option px-4 py-3 border-2 border-slate-200 rounded-lg bg-slate-50 text-center text-sm font-medium text-slate-600 cursor-pointer transition-all hover:border-sky-300 hover:bg-sky-50" data-role="admin">Admin</div>
              </div>
            </div>

            <button type="submit" class="login-button w-full py-3 bg-gradient-to-r from-sky-600 to-blue-600 text-white rounded-lg font-semibold hover:from-sky-700 hover:to-blue-700 transition-all shadow-md hover:shadow-lg" id="loginButton">
              Sign In
            </button>
          </form>

          <div class="relative my-6">
            <div class="absolute inset-0 flex items-center">
              <div class="w-full border-t border-slate-200"></div>
            </div>
            <div class="relative flex justify-center text-sm">
              <span class="px-2 bg-white text-slate-500">or</span>
            </div>
          </div>

          <a href="register.html" class="block w-full py-3 text-center border-2 border-sky-600 text-sky-600 rounded-lg font-semibold hover:bg-sky-50 transition-all">
            Create Account
          </a>
        </div>
      </div>
    </main>

    <footer class="border-t bg-white mt-8">
      <div
        class="mx-auto max-w-6xl px-4 py-6 text-xs text-slate-500 flex justify-between"
      >
        <span>¬© <span id="year"></span> Happy Paws Training</span>
        <span>Login Portal</span>
      </div>
    </footer>

    <script>
      // ============================================================================
      // DOM ELEMENTS
      // ============================================================================
      const loginForm = document.getElementById('loginForm');
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      const passwordToggle = document.getElementById('passwordToggle');
      const loginButton = document.getElementById('loginButton');
      const roleOptions = document.querySelectorAll('.role-option');
      const emailError = document.getElementById('emailError');
      const passwordError = document.getElementById('passwordError');
      const successMessage = document.getElementById('successMessage');
      const adminCredentialsBox = document.getElementById('adminCredentialsBox');

      // ============================================================================
      // HARDCODED ADMIN CREDENTIALS
      // ============================================================================
      const ADMIN_EMAIL = 'admin@hpt.com';
      const ADMIN_PASSWORD = 'Admin123!';

      // ============================================================================
      // ROLE SELECTOR FUNCTIONALITY
      // ============================================================================
      let selectedRole = 'customer';
      
      function updateAdminCredentialsVisibility() {
        if (selectedRole === 'admin') {
          adminCredentialsBox.classList.add('show');
        } else {
          adminCredentialsBox.classList.remove('show');
        }
      }

      roleOptions.forEach(option => {
        option.addEventListener('click', () => {
          roleOptions.forEach(opt => opt.classList.remove('selected'));
          option.classList.add('selected');
          selectedRole = option.dataset.role;
          updateAdminCredentialsVisibility();
        });
      });
      
      updateAdminCredentialsVisibility();

      // ============================================================================
      // PASSWORD TOGGLE FUNCTIONALITY
      // ============================================================================
      passwordToggle.addEventListener('click', () => {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        passwordToggle.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
      });

      // ============================================================================
      // VALIDATION FUNCTIONS
      // ============================================================================
      function validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }

      function showError(element, message) {
        element.textContent = message;
        element.classList.add('show');
        const input = element.previousElementSibling;
        if (input && input.classList.contains('form-input')) {
          input.classList.add('error');
        } else if (input && input.classList.contains('relative')) {
          input.querySelector('.form-input').classList.add('error');
        }
      }

      function clearError(element) {
        element.textContent = '';
        element.classList.remove('show');
        const input = element.previousElementSibling;
        if (input && input.classList.contains('form-input')) {
          input.classList.remove('error');
        } else if (input && input.classList.contains('relative')) {
          input.querySelector('.form-input').classList.remove('error');
        }
      }

      function clearAllErrors() {
        clearError(emailError);
        clearError(passwordError);
        emailInput.classList.remove('error');
        passwordInput.classList.remove('error');
      }

      function validateForm() {
        let isValid = true;
        clearAllErrors();

        const email = emailInput.value.trim();
        if (!email) {
          showError(emailError, 'Email is required');
          isValid = false;
        } else if (!validateEmail(email)) {
          showError(emailError, 'Please enter a valid email address');
          isValid = false;
        }

        const password = passwordInput.value;
        if (!password) {
          showError(passwordError, 'Password is required');
          isValid = false;
        } else if (password.length < 6) {
          showError(passwordError, 'Password must be at least 6 characters');
          isValid = false;
        }

        return isValid;
      }

      // ============================================================================
      // AUTHENTICATION FUNCTIONS
      // ============================================================================
      function authenticateAdmin(email, password) {
        return email === ADMIN_EMAIL && password === ADMIN_PASSWORD;
      }

      async function authenticateCustomer(email, password) {
        try {
          const response = await fetch('http://localhost:3000/api/auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              email: email,
              password: password,
              role: 'customer'
            })
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || 'Invalid email or password');
          }

          if (data.role === 'customer' && data.customerId) {
            localStorage.setItem('customerId', data.customerId);
            localStorage.setItem('hpt_customer_id', data.customerId);
            localStorage.setItem('customerEmail', email);
            return true;
          }

          throw new Error('Invalid response from server');
        } catch (error) {
          console.error('Login error:', error);
          throw error;
        }
      }

      async function authenticateTrainer(email, password) {
        try {
          const response = await fetch('http://localhost:3000/api/auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              email: email,
              password: password,
              role: 'trainer'
            })
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || 'Invalid email or password');
          }

          if (data.role === 'trainer' && data.trainerId) {
            localStorage.setItem('trainerId', data.trainerId);
            localStorage.setItem('hpt_trainer_id', data.trainerId);
            localStorage.setItem('trainerEmail', email);
            return true;
          }

          throw new Error('Invalid response from server');
        } catch (error) {
          console.error('Login error:', error);
          throw error;
        }
      }

      async function authenticateUser(email, password, role) {
        switch (role) {
          case 'admin':
            if (authenticateAdmin(email, password)) {
              localStorage.setItem('userRole', 'admin');
              localStorage.setItem('userEmail', email);
              return true;
            } else {
              throw new Error('Invalid admin credentials. Use admin@hpt.com / Admin123!');
            }
          case 'customer':
            return await authenticateCustomer(email, password);
          case 'trainer':
            return await authenticateTrainer(email, password);
          default:
            throw new Error('Invalid role selected');
        }
      }

      function redirectToPortal(role) {
        const redirectMap = {
          'customer': 'customer.html',
          'trainer': 'trainer.html',
          'admin': 'admin.html'
        };
        const redirectUrl = redirectMap[role] || 'customer.html';
        setTimeout(() => {
          window.location.href = redirectUrl;
        }, 1000);
      }

      // ============================================================================
      // FORM SUBMISSION HANDLER
      // ============================================================================
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        if (!validateForm()) {
          return;
        }

        loginButton.disabled = true;
        loginButton.classList.add('loading');
        loginButton.textContent = 'Signing in...';
        clearAllErrors();
        successMessage.classList.add('hidden');

        try {
          const email = emailInput.value.trim();
          const password = passwordInput.value;

          const authenticated = await authenticateUser(email, password, selectedRole);

          if (authenticated) {
            successMessage.classList.remove('hidden');
            localStorage.setItem('userRole', selectedRole);
            localStorage.setItem('userEmail', email);
            redirectToPortal(selectedRole);
          }
        } catch (error) {
          loginButton.disabled = false;
          loginButton.classList.remove('loading');
          loginButton.textContent = 'Sign In';
          const errorMsg = error.message || 'An error occurred. Please try again.';
          showError(passwordError, errorMsg);
        }
      });

      emailInput.addEventListener('input', () => {
        clearError(emailError);
      });

      passwordInput.addEventListener('input', () => {
        clearError(passwordError);
      });

      passwordInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          loginForm.dispatchEvent(new Event('submit'));
        }
      });

      function copyToClipboard(text, button) {
        navigator.clipboard.writeText(text).then(() => {
          const originalText = button.textContent;
          button.textContent = 'Copied!';
          button.classList.add('bg-emerald-500');
          setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('bg-emerald-500');
          }, 2000);
        }).catch(err => {
          console.error('Failed to copy:', err);
        });
      }

      window.copyToClipboard = copyToClipboard;

      document.getElementById("year").textContent = new Date().getFullYear().toString();
    </script>
  </body>
</html>
