<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Portal - Happy Paws Training</title>
    <meta
      name="description"
      content="System administration, analytics, and overall platform management."
    />
    <!-- Tailwind via CDN for this static page only -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
      }
      .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        background-color: white;
        margin: auto;
        padding: 30px;
        border-radius: 12px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
      }
    </style>
  </head>
  <body class="min-h-screen bg-slate-50 text-slate-900 antialiased">
    <header
      class="border-b bg-white/80 backdrop-blur sticky top-0 z-20 shadow-sm"
    >
      <div
        class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between"
      >
        <div class="flex items-center gap-2">
          <div
            class="h-9 w-9 rounded-full bg-purple-100 flex items-center justify-center"
          >
            <span class="text-purple-600 text-xl font-black">HP</span>
          </div>
          <div>
            <div class="text-lg font-semibold tracking-tight">
              Happy Paws Training
            </div>
            <p class="text-xs text-slate-500">
              Admin Portal
            </p>
          </div>
        </div>
        <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
          <a href="index.html" class="text-slate-700 hover:text-purple-600">Home</a>
          <a
            href="admin.html"
            class="text-purple-600 font-semibold"
            >Admin Portal</a
          >
        </nav>
        <div class="flex items-center gap-3">
          <a
            href="login.html"
            class="text-sm font-medium text-slate-700 hover:text-purple-600"
            >Log out</a
          >
        </div>
      </div>
    </header>

    <main class="flex-1">
      <div class="mx-auto max-w-6xl px-4 py-10 space-y-8">
        <!-- Welcome Section -->
        <section class="space-y-4">
          <div>
            <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight text-slate-900">
              Admin Dashboard
            </h1>
            <p class="text-slate-600 mt-2">
              Manage customers, trainers, classes, and bookings across the platform.
            </p>
          </div>
        </section>

        <!-- Dashboard Stats -->
        <section class="grid gap-4 md:grid-cols-4">
          <div class="rounded-2xl border border-slate-100 bg-white shadow-sm p-6">
            <div class="text-xs text-slate-500 mb-1">Total Customers</div>
            <div class="text-3xl font-semibold text-slate-900" id="totalCustomers">0</div>
          </div>
          <div class="rounded-2xl border border-slate-100 bg-white shadow-sm p-6">
            <div class="text-xs text-slate-500 mb-1">Total Trainers</div>
            <div class="text-3xl font-semibold text-slate-900" id="totalTrainers">0</div>
          </div>
          <div class="rounded-2xl border border-slate-100 bg-white shadow-sm p-6">
            <div class="text-xs text-slate-500 mb-1">Total Classes</div>
            <div class="text-3xl font-semibold text-slate-900" id="totalClasses">0</div>
          </div>
          <div class="rounded-2xl border border-slate-100 bg-white shadow-sm p-6">
            <div class="text-xs text-slate-500 mb-1">Total Bookings</div>
            <div class="text-3xl font-semibold text-slate-900" id="totalBookings">0</div>
          </div>
        </section>

        <!-- Tabs -->
        <section class="space-y-4">
          <div class="border-b border-slate-200">
            <nav class="flex gap-4">
              <button
                class="px-4 py-2 text-sm font-medium border-b-2 border-purple-600 text-purple-600"
                onclick="showTab('customers')"
                id="tab-customers"
              >
                Customers
              </button>
              <button
                class="px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-900"
                onclick="showTab('trainers')"
                id="tab-trainers"
              >
                Trainers
              </button>
              <button
                class="px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-900"
                onclick="showTab('classes')"
                id="tab-classes"
              >
                Classes
              </button>
              <button
                class="px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-900"
                onclick="showTab('bookings')"
                id="tab-bookings"
              >
                Bookings
              </button>
            </nav>
          </div>

          <!-- Customers Tab -->
          <div id="content-customers" class="tab-content">
            <div class="rounded-2xl border border-slate-100 bg-white shadow-sm p-6">
              <div class="overflow-x-auto">
                <table class="w-full text-sm">
                  <thead class="bg-slate-50">
                    <tr>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">ID</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Name</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Email</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Phone</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Address</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="customersTableBody" class="divide-y divide-slate-100">
                    <tr>
                      <td colspan="6" class="px-4 py-8 text-center text-slate-500">Loading...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Trainers Tab -->
          <div id="content-trainers" class="tab-content hidden">
            <div class="rounded-2xl border border-slate-100 bg-white shadow-sm p-6">
              <div class="overflow-x-auto">
                <table class="w-full text-sm">
                  <thead class="bg-slate-50">
                    <tr>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">ID</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Name</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Email</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Specialization</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Years Exp</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="trainersTableBody" class="divide-y divide-slate-100">
                    <tr>
                      <td colspan="6" class="px-4 py-8 text-center text-slate-500">Loading...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Classes Tab -->
          <div id="content-classes" class="tab-content hidden">
            <div class="rounded-2xl border border-slate-100 bg-white shadow-sm p-6">
              <div class="overflow-x-auto">
                <table class="w-full text-sm">
                  <thead class="bg-slate-50">
                    <tr>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">ID</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Class Name</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Trainer</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Date</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Capacity</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Price</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="classesTableBody" class="divide-y divide-slate-100">
                    <tr>
                      <td colspan="7" class="px-4 py-8 text-center text-slate-500">Loading...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Bookings Tab -->
          <div id="content-bookings" class="tab-content hidden">
            <div class="rounded-2xl border border-slate-100 bg-white shadow-sm p-6">
              <div class="overflow-x-auto">
                <table class="w-full text-sm">
                  <thead class="bg-slate-50">
                    <tr>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">ID</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Customer</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Class</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Date</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Status</th>
                      <th class="px-4 py-3 text-left font-semibold text-slate-700">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="bookingsTableBody" class="divide-y divide-slate-100">
                    <tr>
                      <td colspan="6" class="px-4 py-8 text-center text-slate-500">Loading...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold text-slate-900" id="modalTitle">Edit</h2>
          <button onclick="closeModal()" class="text-slate-500 hover:text-slate-700">✕</button>
        </div>
        <form id="editForm" onsubmit="handleSave(event)">
          <div id="editFormContent"></div>
          <div class="flex gap-3 mt-6">
            <button
              type="submit"
              class="flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-purple-700"
            >
              Save
            </button>
            <button
              type="button"
              onclick="closeModal()"
              class="flex-1 bg-slate-200 text-slate-700 px-4 py-2 rounded-lg font-semibold hover:bg-slate-300"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

    <footer class="border-t bg-white mt-8">
      <div
        class="mx-auto max-w-6xl px-4 py-6 text-xs text-slate-500 flex justify-between"
      >
        <span>© <span id="year"></span> Happy Paws Training</span>
        <span>Admin Portal</span>
      </div>
    </footer>

    <script>
      document.getElementById("year").textContent = new Date().getFullYear().toString();

      let currentTab = 'customers';
      let currentEditType = null;
      let currentEditId = null;

      // Tab switching
      function showTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('nav button').forEach(btn => {
          btn.classList.remove('border-b-2', 'border-purple-600', 'text-purple-600');
          btn.classList.add('text-slate-600');
        });
        document.getElementById(`content-${tab}`).classList.remove('hidden');
        document.getElementById(`tab-${tab}`).classList.add('border-b-2', 'border-purple-600', 'text-purple-600');
        document.getElementById(`tab-${tab}`).classList.remove('text-slate-600');
        
        if (tab === 'customers') loadCustomers();
        else if (tab === 'trainers') loadTrainers();
        else if (tab === 'classes') loadClasses();
        else if (tab === 'bookings') loadBookings();
      }

      // Load dashboard data
      async function loadDashboard() {
        try {
          const [customersRes, trainersRes, classesRes, bookingsRes] = await Promise.all([
            fetch('http://localhost:3000/api/customers'),
            fetch('http://localhost:3000/api/trainers'),
            fetch('http://localhost:3000/api/classes'),
            fetch('http://localhost:3000/api/bookings')
          ]);

          const [customers, trainers, classes, bookings] = await Promise.all([
            customersRes.json(),
            trainersRes.json(),
            classesRes.json(),
            bookingsRes.json()
          ]);

          document.getElementById('totalCustomers').textContent = customers.length || 0;
          document.getElementById('totalTrainers').textContent = trainers.length || 0;
          document.getElementById('totalClasses').textContent = classes.length || 0;
          document.getElementById('totalBookings').textContent = bookings.length || 0;
        } catch (error) {
          console.error('Error loading dashboard:', error);
        }
      }

      // Load and display customers
      async function loadCustomers() {
        try {
          const response = await fetch('http://localhost:3000/api/customers');
          const customers = await response.json();
          const tbody = document.getElementById('customersTableBody');
          
          if (customers.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-slate-500">No customers found</td></tr>';
            return;
          }

          tbody.innerHTML = customers.map(c => `
            <tr>
              <td class="px-4 py-3">${c.CustomerID}</td>
              <td class="px-4 py-3">${c.FName} ${c.LName}</td>
              <td class="px-4 py-3">${c.Email || '-'}</td>
              <td class="px-4 py-3">${c.Phone || '-'}</td>
              <td class="px-4 py-3">${c.Address || '-'}</td>
              <td class="px-4 py-3">
                <button onclick="editCustomer(${c.CustomerID})" class="text-purple-600 hover:text-purple-800 mr-2">Edit</button>
                <button onclick="deleteCustomer(${c.CustomerID})" class="text-red-600 hover:text-red-800">Delete</button>
              </td>
            </tr>
          `).join('');
        } catch (error) {
          console.error('Error loading customers:', error);
          document.getElementById('customersTableBody').innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-red-500">Error loading customers</td></tr>';
        }
      }

      // Load and display trainers
      async function loadTrainers() {
        try {
          const response = await fetch('http://localhost:3000/api/trainers');
          const trainers = await response.json();
          const tbody = document.getElementById('trainersTableBody');
          
          if (trainers.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-slate-500">No trainers found</td></tr>';
            return;
          }

          tbody.innerHTML = trainers.map(t => `
            <tr>
              <td class="px-4 py-3">${t.TrainerID}</td>
              <td class="px-4 py-3">${t.FName} ${t.LName}</td>
              <td class="px-4 py-3">${t.Email || '-'}</td>
              <td class="px-4 py-3">${t.Specialization || '-'}</td>
              <td class="px-4 py-3">${t.YearsOfExperience || 0}</td>
              <td class="px-4 py-3">
                <button onclick="editTrainer(${t.TrainerID})" class="text-purple-600 hover:text-purple-800 mr-2">Edit</button>
                <button onclick="deleteTrainer(${t.TrainerID})" class="text-red-600 hover:text-red-800">Delete</button>
              </td>
            </tr>
          `).join('');
        } catch (error) {
          console.error('Error loading trainers:', error);
          document.getElementById('trainersTableBody').innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-red-500">Error loading trainers</td></tr>';
        }
      }

      // Load and display classes
      async function loadClasses() {
        try {
          const response = await fetch('http://localhost:3000/api/classes');
          const classes = await response.json();
          const tbody = document.getElementById('classesTableBody');
          
          if (classes.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" class="px-4 py-8 text-center text-slate-500">No classes found</td></tr>';
            return;
          }

          tbody.innerHTML = classes.map(c => `
            <tr>
              <td class="px-4 py-3">${c.ClassID}</td>
              <td class="px-4 py-3">${c.ClassName || '-'}</td>
              <td class="px-4 py-3">${c.TrainerName || '-'}</td>
              <td class="px-4 py-3">${c.ScheduleDate ? new Date(c.ScheduleDate).toLocaleDateString() : '-'}</td>
              <td class="px-4 py-3">${c.BookedCount || 0}/${c.Capacity || 0}</td>
              <td class="px-4 py-3">$${c.Price || 0}</td>
              <td class="px-4 py-3">
                <button onclick="editClass(${c.ClassID})" class="text-purple-600 hover:text-purple-800 mr-2">Edit</button>
                <button onclick="deleteClass(${c.ClassID})" class="text-red-600 hover:text-red-800">Delete</button>
              </td>
            </tr>
          `).join('');
        } catch (error) {
          console.error('Error loading classes:', error);
          document.getElementById('classesTableBody').innerHTML = '<tr><td colspan="7" class="px-4 py-8 text-center text-red-500">Error loading classes</td></tr>';
        }
      }

      // Load and display bookings
      async function loadBookings() {
        try {
          const response = await fetch('http://localhost:3000/api/bookings');
          const bookings = await response.json();
          const tbody = document.getElementById('bookingsTableBody');
          
          if (bookings.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-slate-500">No bookings found</td></tr>';
            return;
          }

          tbody.innerHTML = bookings.map(b => `
            <tr>
              <td class="px-4 py-3">${b.BookingID}</td>
              <td class="px-4 py-3">${b.CustomerName || '-'}</td>
              <td class="px-4 py-3">${b.ClassName || '-'}</td>
              <td class="px-4 py-3">${b.BookingDate ? new Date(b.BookingDate).toLocaleDateString() : '-'}</td>
              <td class="px-4 py-3">
                <span class="px-2 py-1 rounded text-xs font-medium ${
                  b.Status === 'Scheduled' ? 'bg-emerald-100 text-emerald-700' :
                  b.Status === 'Completed' ? 'bg-blue-100 text-blue-700' :
                  'bg-red-100 text-red-700'
                }">${b.Status || 'Unknown'}</span>
              </td>
              <td class="px-4 py-3">
                <button onclick="editBooking(${b.BookingID})" class="text-purple-600 hover:text-purple-800 mr-2">Edit</button>
                <button onclick="deleteBooking(${b.BookingID})" class="text-red-600 hover:text-red-800">Delete</button>
              </td>
            </tr>
          `).join('');
        } catch (error) {
          console.error('Error loading bookings:', error);
          document.getElementById('bookingsTableBody').innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-red-500">Error loading bookings</td></tr>';
        }
      }

      // Edit functions
      async function editCustomer(id) {
        try {
          const response = await fetch(`http://localhost:3000/api/customer?customerId=${id}`);
          const customer = await response.json();
          currentEditType = 'customer';
          currentEditId = id;
          
          document.getElementById('modalTitle').textContent = 'Edit Customer';
          document.getElementById('editFormContent').innerHTML = `
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">First Name</label>
                <input type="text" name="firstName" value="${customer.FName || ''}" class="w-full px-4 py-2 border rounded-lg" required>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Last Name</label>
                <input type="text" name="lastName" value="${customer.LName || ''}" class="w-full px-4 py-2 border rounded-lg" required>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Email</label>
                <input type="email" name="email" value="${customer.Email || ''}" class="w-full px-4 py-2 border rounded-lg" required>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Phone</label>
                <input type="text" name="phone" value="${customer.Phone || ''}" class="w-full px-4 py-2 border rounded-lg">
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Address</label>
                <input type="text" name="address" value="${customer.Address || ''}" class="w-full px-4 py-2 border rounded-lg">
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">New Password (leave blank to keep current)</label>
                <input type="password" name="password" class="w-full px-4 py-2 border rounded-lg">
              </div>
            </div>
          `;
          document.getElementById('editModal').classList.add('show');
        } catch (error) {
          alert('Error loading customer: ' + error.message);
        }
      }

      async function editTrainer(id) {
        try {
          const response = await fetch(`http://localhost:3000/api/trainer?trainerId=${id}`);
          const trainer = await response.json();
          currentEditType = 'trainer';
          currentEditId = id;
          
          document.getElementById('modalTitle').textContent = 'Edit Trainer';
          document.getElementById('editFormContent').innerHTML = `
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">First Name</label>
                <input type="text" name="firstName" value="${trainer.FName || ''}" class="w-full px-4 py-2 border rounded-lg" required>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Last Name</label>
                <input type="text" name="lastName" value="${trainer.LName || ''}" class="w-full px-4 py-2 border rounded-lg" required>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Email</label>
                <input type="email" name="email" value="${trainer.Email || ''}" class="w-full px-4 py-2 border rounded-lg" required>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Specialization</label>
                <select name="specialization" class="w-full px-4 py-2 border rounded-lg">
                  <option value="">Select specialization...</option>
                  <option value="Puppy obedience" ${trainer.Specialization === 'Puppy obedience' ? 'selected' : ''}>Puppy obedience</option>
                  <option value="Agility training" ${trainer.Specialization === 'Agility training' ? 'selected' : ''}>Agility training</option>
                  <option value="Behavior correction" ${trainer.Specialization === 'Behavior correction' ? 'selected' : ''}>Behavior correction</option>
                  <option value="Service dogs" ${trainer.Specialization === 'Service dogs' ? 'selected' : ''}>Service dogs</option>
                  <option value="Basic obedience" ${trainer.Specialization === 'Basic obedience' ? 'selected' : ''}>Basic obedience</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Years of Experience</label>
                <input type="number" name="yearsOfExperience" value="${trainer.YearsOfExperience || 0}" min="0" max="60" class="w-full px-4 py-2 border rounded-lg" required>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">New Password (leave blank to keep current)</label>
                <input type="password" name="password" class="w-full px-4 py-2 border rounded-lg">
              </div>
            </div>
          `;
          document.getElementById('editModal').classList.add('show');
        } catch (error) {
          alert('Error loading trainer: ' + error.message);
        }
      }

      async function editClass(id) {
        // Use existing classes API endpoint
        try {
          const response = await fetch('http://localhost:3000/api/classes');
          const classes = await response.json();
          const classItem = classes.find(c => c.ClassID === id);
          if (!classItem) throw new Error('Class not found');
          
          currentEditType = 'class';
          currentEditId = id;
          
          document.getElementById('modalTitle').textContent = 'Edit Class';
          document.getElementById('editFormContent').innerHTML = `
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Class Name</label>
                <input type="text" name="title" value="${classItem.ClassName || ''}" class="w-full px-4 py-2 border rounded-lg" required>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Description</label>
                <textarea name="description" class="w-full px-4 py-2 border rounded-lg" rows="3">${classItem.Description || ''}</textarea>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Type</label>
                <input type="text" name="type" value="${classItem.Type || ''}" class="w-full px-4 py-2 border rounded-lg">
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Schedule Date</label>
                <input type="datetime-local" name="startDateTime" value="${classItem.ScheduleDate ? new Date(classItem.ScheduleDate).toISOString().slice(0, 16) : ''}" class="w-full px-4 py-2 border rounded-lg">
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Capacity</label>
                <input type="number" name="capacity" value="${classItem.Capacity || 0}" min="1" class="w-full px-4 py-2 border rounded-lg" required>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Price</label>
                <input type="number" name="price" value="${classItem.Price || 0}" min="0" step="0.01" class="w-full px-4 py-2 border rounded-lg" required>
              </div>
            </div>
          `;
          document.getElementById('editModal').classList.add('show');
        } catch (error) {
          alert('Error loading class: ' + error.message);
        }
      }

      async function editBooking(id) {
        try {
          const response = await fetch('http://localhost:3000/api/bookings');
          const bookings = await response.json();
          const booking = bookings.find(b => b.BookingID === id);
          if (!booking) throw new Error('Booking not found');
          
          currentEditType = 'booking';
          currentEditId = id;
          
          document.getElementById('modalTitle').textContent = 'Edit Booking';
          document.getElementById('editFormContent').innerHTML = `
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Booking Date</label>
                <input type="date" name="bookingDate" value="${booking.BookingDate ? new Date(booking.BookingDate).toISOString().split('T')[0] : ''}" class="w-full px-4 py-2 border rounded-lg" required>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Status</label>
                <select name="status" class="w-full px-4 py-2 border rounded-lg" required>
                  <option value="Scheduled" ${booking.Status === 'Scheduled' ? 'selected' : ''}>Scheduled</option>
                  <option value="Completed" ${booking.Status === 'Completed' ? 'selected' : ''}>Completed</option>
                  <option value="Cancelled" ${booking.Status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                </select>
              </div>
            </div>
          `;
          document.getElementById('editModal').classList.add('show');
        } catch (error) {
          alert('Error loading booking: ' + error.message);
        }
      }

      // Delete functions
      async function deleteCustomer(id) {
        if (!confirm('Are you sure you want to delete this customer?')) return;
        try {
          const response = await fetch(`http://localhost:3000/api/customer?customerId=${id}`, { method: 'DELETE' });
          const data = await response.json();
          if (response.ok) {
            loadCustomers();
            loadDashboard();
          } else {
            alert(data.message || 'Error deleting customer');
          }
        } catch (error) {
          alert('Error deleting customer: ' + error.message);
        }
      }

      async function deleteTrainer(id) {
        if (!confirm('Are you sure you want to delete this trainer?')) return;
        try {
          const response = await fetch(`http://localhost:3000/api/trainer?trainerId=${id}`, { method: 'DELETE' });
          const data = await response.json();
          if (response.ok) {
            loadTrainers();
            loadDashboard();
          } else {
            alert(data.message || 'Error deleting trainer');
          }
        } catch (error) {
          alert('Error deleting trainer: ' + error.message);
        }
      }

      async function deleteClass(id) {
        if (!confirm('Are you sure you want to delete this class?')) return;
        try {
          const response = await fetch(`http://localhost:3000/api/classes/${id}`, { method: 'DELETE' });
          const data = await response.json();
          if (response.ok) {
            loadClasses();
            loadDashboard();
          } else {
            alert(data.message || 'Error deleting class');
          }
        } catch (error) {
          alert('Error deleting class: ' + error.message);
        }
      }

      async function deleteBooking(id) {
        if (!confirm('Are you sure you want to delete this booking?')) return;
        try {
          // Update booking status to Cancelled instead of deleting
          const response = await fetch('http://localhost:3000/api/bookings', {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ bookingId: id, status: 'Cancelled' })
          });
          const data = await response.json();
          if (response.ok) {
            loadBookings();
            loadDashboard();
          } else {
            alert(data.message || 'Error deleting booking');
          }
        } catch (error) {
          alert('Error deleting booking: ' + error.message);
        }
      }

      // Save handler
      async function handleSave(event) {
        event.preventDefault();
        const formData = new FormData(event.target);
        const data = {};
        
        for (const [key, value] of formData.entries()) {
          if (value) data[key] = value;
        }

        try {
          let url, method;
          if (currentEditType === 'customer') {
            url = `http://localhost:3000/api/customer?customerId=${currentEditId}`;
            method = 'PATCH';
            const updateData = {
              firstName: data.firstName,
              lastName: data.lastName,
              email: data.email,
              phone: data.phone || null,
              address: data.address || null
            };
            if (data.password) updateData.password = data.password;
            const response = await fetch(url, {
              method,
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(updateData)
            });
            const result = await response.json();
            if (response.ok) {
              closeModal();
              loadCustomers();
              loadDashboard();
            } else {
              alert(result.message || 'Error updating customer');
            }
          } else if (currentEditType === 'trainer') {
            url = `http://localhost:3000/api/trainer?trainerId=${currentEditId}`;
            method = 'PATCH';
            const updateData = {
              firstName: data.firstName,
              lastName: data.lastName,
              email: data.email,
              specialization: data.specialization || null,
              yearsOfExperience: parseInt(data.yearsOfExperience) || 0
            };
            if (data.password) updateData.password = data.password;
            const response = await fetch(url, {
              method,
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(updateData)
            });
            const result = await response.json();
            if (response.ok) {
              closeModal();
              loadTrainers();
              loadDashboard();
            } else {
              alert(result.message || 'Error updating trainer');
            }
          } else if (currentEditType === 'class') {
            url = `http://localhost:3000/api/classes/${currentEditId}`;
            method = 'PATCH';
            const updateData = {};
            if (data.title) updateData.title = data.title;
            if (data.description !== undefined) updateData.description = data.description;
            if (data.type) updateData.type = data.type;
            if (data.startDateTime) updateData.startDateTime = data.startDateTime;
            if (data.capacity) updateData.capacity = parseInt(data.capacity);
            if (data.price) updateData.price = parseFloat(data.price);
            const response = await fetch(url, {
              method,
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(updateData)
            });
            const result = await response.json();
            if (response.ok) {
              closeModal();
              loadClasses();
              loadDashboard();
            } else {
              alert(result.message || 'Error updating class');
            }
          } else if (currentEditType === 'booking') {
            url = 'http://localhost:3000/api/bookings';
            method = 'PATCH';
            const response = await fetch(url, {
              method,
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                bookingId: currentEditId,
                bookingDate: data.bookingDate,
                status: data.status
              })
            });
            const result = await response.json();
            if (response.ok) {
              closeModal();
              loadBookings();
              loadDashboard();
            } else {
              alert(result.message || 'Error updating booking');
            }
          }
        } catch (error) {
          alert('Error saving: ' + error.message);
        }
      }

      function closeModal() {
        document.getElementById('editModal').classList.remove('show');
        currentEditType = null;
        currentEditId = null;
      }

      // Initialize
      loadDashboard();
      loadCustomers();
    </script>
  </body>
</html>

