<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Account - Happy Paws Training</title>
    <meta
      name="description"
      content="Create your Happy Paws Training account - Join as a customer or trainer."
    />
    <!-- Tailwind via CDN for this static page only -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }
      .error-message {
        display: none;
        color: #ef4444;
        font-size: 13px;
        margin-top: 6px;
      }
      .error-message.show {
        display: block;
      }
      .form-input.error,
      .form-select.error {
        border-color: #ef4444;
        background: #fef2f2;
      }
      .password-strength {
        margin-top: 6px;
        font-size: 12px;
        color: #64748b;
      }
      .password-strength.weak {
        color: #ef4444;
      }
      .password-strength.medium {
        color: #f59e0b;
      }
      .password-strength.strong {
        color: #10b981;
      }
      .register-button.loading {
        position: relative;
        color: transparent;
      }
      .register-button.loading::after {
        content: "";
        position: absolute;
        width: 20px;
        height: 20px;
        top: 50%;
        left: 50%;
        margin-left: -10px;
        margin-top: -10px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body class="min-h-screen bg-slate-50 text-slate-900 antialiased">
    <header
      class="border-b bg-white/80 backdrop-blur sticky top-0 z-20 shadow-sm"
    >
      <div
        class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between"
      >
        <div class="flex items-center gap-2">
          <div
            class="h-9 w-9 rounded-full bg-sky-100 flex items-center justify-center"
          >
            <span class="text-sky-600 text-xl font-black">HP</span>
          </div>
          <div>
            <div class="text-lg font-semibold tracking-tight">
              Happy Paws Training
            </div>
            <p class="text-xs text-slate-500">
              Book classes &amp; private training with ease
            </p>
          </div>
        </div>
        <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
          <a href="index.html" class="text-slate-700 hover:text-sky-600">Home</a>
          <a
            href="customer.html"
            class="text-slate-700 hover:text-sky-600"
            >Customer Portal</a
          >
          <a
            href="trainer.html"
            class="text-slate-700 hover:text-sky-600"
            >Trainer Portal</a
          >
        </nav>
        <div class="flex items-center gap-3">
          <a
            href="login.html"
            class="text-sm font-medium text-slate-700 hover:text-sky-600"
            >Log in</a
          >
          <a
            href="register.html"
            class="inline-flex items-center rounded-full bg-sky-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-sky-700"
          >
            Get started
          </a>
        </div>
      </div>
    </header>

    <main class="flex-1 flex items-center justify-center min-h-[calc(100vh-200px)] py-10 px-4">
      <div class="w-full max-w-lg">
        <div class="bg-white rounded-2xl shadow-lg p-8 space-y-5">
          <div class="text-center mb-6">
            <div class="text-3xl font-bold bg-gradient-to-r from-sky-600 to-blue-600 bg-clip-text text-transparent mb-2">
              üêæ Happy Paws
            </div>
            <div class="text-sm text-slate-500">Create Your Account</div>
          </div>

          <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-3 text-sm text-emerald-800 hidden" id="successMessage">
            Account created successfully! Redirecting to login...
          </div>

          <form id="registerForm" class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2" for="firstName">First Name</label>
                <input
                  type="text"
                  id="firstName"
                  class="form-input w-full px-4 py-3 border-2 border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition-all"
                  placeholder="John"
                  required
                  autocomplete="given-name"
                />
                <div class="error-message" id="firstNameError"></div>
              </div>

              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2" for="lastName">Last Name</label>
                <input
                  type="text"
                  id="lastName"
                  class="form-input w-full px-4 py-3 border-2 border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition-all"
                  placeholder="Doe"
                  required
                  autocomplete="family-name"
                />
                <div class="error-message" id="lastNameError"></div>
              </div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2" for="email">Email Address</label>
              <input
                type="email"
                id="email"
                class="form-input w-full px-4 py-3 border-2 border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition-all"
                placeholder="you@example.com"
                required
                autocomplete="email"
              />
              <div class="error-message" id="emailError"></div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2" for="phone">Phone Number</label>
              <input
                type="tel"
                id="phone"
                class="form-input w-full px-4 py-3 border-2 border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition-all"
                placeholder="(555) 123-4567"
                required
                autocomplete="tel"
              />
              <div class="error-message" id="phoneError"></div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2" for="role">Register As</label>
              <select id="role" class="form-select w-full px-4 py-3 border-2 border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition-all" required>
                <option value="">Select a role...</option>
                <option value="customer">Customer</option>
                <option value="trainer">Trainer</option>
              </select>
              <div class="error-message" id="roleError"></div>
            </div>

            <!-- Customer-only fields -->
            <div id="customerFields" class="hidden">
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2" for="address">Address</label>
                <input
                  type="text"
                  id="address"
                  class="form-input w-full px-4 py-3 border-2 border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition-all"
                  placeholder="123 Main St, City, State ZIP"
                />
                <div class="error-message" id="addressError"></div>
              </div>
            </div>

            <!-- Trainer-only fields -->
            <div id="trainerFields" class="hidden">
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2" for="specialization">Specialization</label>
                <select id="specialization" class="form-select w-full px-4 py-3 border-2 border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition-all">
                  <option value="">Select specialization...</option>
                  <option value="Puppy obedience">Puppy obedience</option>
                  <option value="Agility training">Agility training</option>
                  <option value="Behavior correction">Behavior correction</option>
                  <option value="Service dogs">Service dogs</option>
                  <option value="Basic obedience">Basic obedience</option>
                </select>
                <div class="error-message" id="specializationError"></div>
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2" for="yearsOfExperience">Years of Experience</label>
                <input
                  type="number"
                  id="yearsOfExperience"
                  class="form-input w-full px-4 py-3 border-2 border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition-all"
                  placeholder="0"
                  min="0"
                  max="60"
                />
                <div class="error-message" id="yearsOfExperienceError"></div>
              </div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2" for="password">Password</label>
              <div class="relative">
                <input
                  type="password"
                  id="password"
                  class="form-input w-full px-4 py-3 pr-12 border-2 border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition-all"
                  placeholder="Create a password"
                  required
                  autocomplete="new-password"
                />
                <button
                  type="button"
                  class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-sky-600 text-lg"
                  id="passwordToggle"
                  aria-label="Toggle password visibility"
                >
                  üëÅÔ∏è
                </button>
              </div>
              <div class="password-strength" id="passwordStrength"></div>
              <div class="error-message" id="passwordError"></div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2" for="confirmPassword">Confirm Password</label>
              <div class="relative">
                <input
                  type="password"
                  id="confirmPassword"
                  class="form-input w-full px-4 py-3 pr-12 border-2 border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition-all"
                  placeholder="Confirm your password"
                  required
                  autocomplete="new-password"
                />
                <button
                  type="button"
                  class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-sky-600 text-lg"
                  id="confirmPasswordToggle"
                  aria-label="Toggle password visibility"
                >
                  üëÅÔ∏è
                </button>
              </div>
              <div class="error-message" id="confirmPasswordError"></div>
            </div>

            <button type="submit" class="register-button w-full py-3 bg-gradient-to-r from-sky-600 to-blue-600 text-white rounded-lg font-semibold hover:from-sky-700 hover:to-blue-700 transition-all shadow-md hover:shadow-lg" id="registerButton">
              Create Account
            </button>
          </form>

          <div class="text-center mt-6 text-sm text-slate-600">
            Already have an account? <a href="login.html" class="text-sky-600 font-semibold hover:text-sky-700 hover:underline">Log in</a>
          </div>
        </div>
      </div>
    </main>

    <footer class="border-t bg-white mt-8">
      <div
        class="mx-auto max-w-6xl px-4 py-6 text-xs text-slate-500 flex justify-between"
      >
        <span>¬© <span id="year"></span> Happy Paws Training</span>
        <span>Registration Portal</span>
      </div>
    </footer>

    <script>
      // ============================================================================
      // DOM ELEMENTS
      // ============================================================================
      const registerForm = document.getElementById('registerForm');
      const firstNameInput = document.getElementById('firstName');
      const lastNameInput = document.getElementById('lastName');
      const emailInput = document.getElementById('email');
      const phoneInput = document.getElementById('phone');
      const roleSelect = document.getElementById('role');
      const passwordInput = document.getElementById('password');
      const confirmPasswordInput = document.getElementById('confirmPassword');
      const passwordToggle = document.getElementById('passwordToggle');
      const confirmPasswordToggle = document.getElementById('confirmPasswordToggle');
      const registerButton = document.getElementById('registerButton');
      const successMessage = document.getElementById('successMessage');
      const passwordStrength = document.getElementById('passwordStrength');
      const customerFields = document.getElementById('customerFields');
      const trainerFields = document.getElementById('trainerFields');
      const addressInput = document.getElementById('address');
      const specializationSelect = document.getElementById('specialization');
      const yearsOfExperienceInput = document.getElementById('yearsOfExperience');

      const firstNameError = document.getElementById('firstNameError');
      const lastNameError = document.getElementById('lastNameError');
      const emailError = document.getElementById('emailError');
      const phoneError = document.getElementById('phoneError');
      const roleError = document.getElementById('roleError');
      const passwordError = document.getElementById('passwordError');
      const confirmPasswordError = document.getElementById('confirmPasswordError');
      const addressError = document.getElementById('addressError');
      const specializationError = document.getElementById('specializationError');
      const yearsOfExperienceError = document.getElementById('yearsOfExperienceError');

      // ============================================================================
      // PASSWORD TOGGLE FUNCTIONALITY
      // ============================================================================
      passwordToggle.addEventListener('click', () => {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        passwordToggle.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
      });

      confirmPasswordToggle.addEventListener('click', () => {
        const type = confirmPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        confirmPasswordInput.setAttribute('type', type);
        confirmPasswordToggle.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
      });

      // ============================================================================
      // PASSWORD STRENGTH INDICATOR
      // ============================================================================
      function checkPasswordStrength(password) {
        if (!password) {
          passwordStrength.textContent = '';
          passwordStrength.className = 'password-strength';
          return;
        }

        let strength = 0;

        if (password.length >= 8) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;

        if (strength <= 2) {
          passwordStrength.textContent = 'Weak password';
          passwordStrength.className = 'password-strength weak';
        } else if (strength <= 3) {
          passwordStrength.textContent = 'Medium password';
          passwordStrength.className = 'password-strength medium';
        } else {
          passwordStrength.textContent = 'Strong password';
          passwordStrength.className = 'password-strength strong';
        }
      }

      passwordInput.addEventListener('input', (e) => {
        checkPasswordStrength(e.target.value);
        clearError(passwordError);
      });

      // ============================================================================
      // VALIDATION FUNCTIONS
      // ============================================================================
      function validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }

      function validatePhone(phone) {
        const cleaned = phone.replace(/[\s\-\(\)]/g, '');
        const phoneRegex = /^[\d\s\-\(\)]{10,}$/;
        return phoneRegex.test(cleaned) && cleaned.replace(/\D/g, '').length >= 10;
      }

      function showError(element, message) {
        element.textContent = message;
        element.classList.add('show');
        const input = element.previousElementSibling;
        if (input && (input.classList.contains('form-input') || input.classList.contains('form-select'))) {
          input.classList.add('error');
        } else if (input && input.classList.contains('relative')) {
          input.querySelector('.form-input').classList.add('error');
        } else if (input && input.classList.contains('password-strength')) {
          const passwordInput = input.previousElementSibling.querySelector('.form-input');
          if (passwordInput) passwordInput.classList.add('error');
        }
      }

      function clearError(element) {
        element.textContent = '';
        element.classList.remove('show');
        const input = element.previousElementSibling;
        if (input && (input.classList.contains('form-input') || input.classList.contains('form-select'))) {
          input.classList.remove('error');
        } else if (input && input.classList.contains('relative')) {
          input.querySelector('.form-input').classList.remove('error');
        } else if (input && input.classList.contains('password-strength')) {
          const passwordInput = input.previousElementSibling.querySelector('.form-input');
          if (passwordInput) passwordInput.classList.remove('error');
        }
      }

      function clearAllErrors() {
        clearError(firstNameError);
        clearError(lastNameError);
        clearError(emailError);
        clearError(phoneError);
        clearError(roleError);
        clearError(passwordError);
        clearError(confirmPasswordError);
        clearError(addressError);
        clearError(specializationError);
        clearError(yearsOfExperienceError);
        
        firstNameInput.classList.remove('error');
        lastNameInput.classList.remove('error');
        emailInput.classList.remove('error');
        phoneInput.classList.remove('error');
        roleSelect.classList.remove('error');
        passwordInput.classList.remove('error');
        confirmPasswordInput.classList.remove('error');
        addressInput.classList.remove('error');
        specializationSelect.classList.remove('error');
        yearsOfExperienceInput.classList.remove('error');
      }

      function validateForm() {
        let isValid = true;
        clearAllErrors();

        const firstName = firstNameInput.value.trim();
        if (!firstName) {
          showError(firstNameError, 'First name is required');
          isValid = false;
        } else if (firstName.length < 2) {
          showError(firstNameError, 'First name must be at least 2 characters');
          isValid = false;
        }

        const lastName = lastNameInput.value.trim();
        if (!lastName) {
          showError(lastNameError, 'Last name is required');
          isValid = false;
        } else if (lastName.length < 2) {
          showError(lastNameError, 'Last name must be at least 2 characters');
          isValid = false;
        }

        const email = emailInput.value.trim();
        if (!email) {
          showError(emailError, 'Email is required');
          isValid = false;
        } else if (!validateEmail(email)) {
          showError(emailError, 'Please enter a valid email address');
          isValid = false;
        }

        const phone = phoneInput.value.trim();
        if (!phone) {
          showError(phoneError, 'Phone number is required');
          isValid = false;
        } else if (!validatePhone(phone)) {
          showError(phoneError, 'Please enter a valid phone number');
          isValid = false;
        }

        const role = roleSelect.value;
        if (!role) {
          showError(roleError, 'Please select a role');
          isValid = false;
        }

        const password = passwordInput.value;
        if (!password) {
          showError(passwordError, 'Password is required');
          isValid = false;
        } else if (password.length < 8) {
          showError(passwordError, 'Password must be at least 8 characters');
          isValid = false;
        }

        const confirmPassword = confirmPasswordInput.value;
        if (!confirmPassword) {
          showError(confirmPasswordError, 'Please confirm your password');
          isValid = false;
        } else if (password !== confirmPassword) {
          showError(confirmPasswordError, 'Passwords do not match');
          isValid = false;
        }

        // Validate role-specific fields
        if (role === 'customer') {
          const address = addressInput.value.trim();
          if (!address) {
            showError(addressError, 'Address is required');
            isValid = false;
          } else if (address.length < 5) {
            showError(addressError, 'Please enter a valid address');
            isValid = false;
          }
        } else if (role === 'trainer') {
          const specialization = specializationSelect.value.trim();
          if (!specialization) {
            showError(specializationError, 'Please select a specialization');
            isValid = false;
          }

          const years = parseInt(yearsOfExperienceInput.value);
          if (!yearsOfExperienceInput.value || yearsOfExperienceInput.value === '') {
            showError(yearsOfExperienceError, 'Years of experience is required');
            isValid = false;
          } else if (isNaN(years) || years < 0 || years > 60) {
            showError(yearsOfExperienceError, 'Years of experience must be between 0 and 60');
            isValid = false;
          }
        }

        return isValid;
      }

      // ============================================================================
      // REGISTRATION SUBMISSION FUNCTIONS
      // ============================================================================
      async function submitRegistration() {
        const registrationData = {
          firstName: firstNameInput.value.trim(),
          lastName: lastNameInput.value.trim(),
          email: emailInput.value.trim(),
          phone: phoneInput.value.trim(),
          role: roleSelect.value,
          password: passwordInput.value
        };

        // Add role-specific fields
        if (roleSelect.value === 'customer') {
          registrationData.address = addressInput.value.trim();
        } else if (roleSelect.value === 'trainer') {
          registrationData.specialization = specializationSelect.value.trim();
          registrationData.yearsOfExperience = parseInt(yearsOfExperienceInput.value) || 0;
        }

        console.log('Registration data:', {
          ...registrationData,
          password: '***'
        });

        const result = await sendRegistrationToServer(registrationData);
        return result;
      }

      async function sendRegistrationToServer(data) {
        try {
          const response = await fetch('http://localhost:3000/api/auth/signup', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              firstName: data.firstName,
              lastName: data.lastName,
              email: data.email,
              phone: data.phone,
              password: data.password,
              role: data.role,
              address: data.address || null,
              specialization: data.specialization || null,
              yearsOfExperience: data.yearsOfExperience || null
            })
          });

          const result = await response.json();

          if (!response.ok) {
            throw new Error(result.message || 'Failed to create account');
          }

          return {
            success: true,
            message: result.message || 'Account created successfully',
            userId: result.customerId || result.trainerId,
            role: result.role
          };
        } catch (error) {
          console.error('Registration error:', error);
          if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
            throw new Error('Cannot connect to server. Make sure npm run dev is running on http://localhost:3000');
          }
          throw new Error(error.message || 'Failed to create account. Please try again.');
        }
      }

      // ============================================================================
      // FORM SUBMISSION HANDLER
      // ============================================================================
      registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        if (!validateForm()) {
          return;
        }

        registerButton.disabled = true;
        registerButton.classList.add('loading');
        registerButton.textContent = 'Creating account...';
        clearAllErrors();
        successMessage.classList.add('hidden');

        try {
          const result = await submitRegistration();

          if (result.success) {
            successMessage.classList.remove('hidden');
            setTimeout(() => {
              window.location.href = 'login.html';
            }, 2000);
          }
        } catch (error) {
          registerButton.disabled = false;
          registerButton.classList.remove('loading');
          registerButton.textContent = 'Create Account';

          const errorMsg = error.message || 'An error occurred. Please try again.';
          
          if (errorMsg.toLowerCase().includes('email')) {
            showError(emailError, errorMsg);
          } else {
            showError(passwordError, errorMsg);
          }
        }
      });

      // ============================================================================
      // INPUT EVENT LISTENERS
      // ============================================================================
      firstNameInput.addEventListener('input', () => {
        clearError(firstNameError);
      });

      lastNameInput.addEventListener('input', () => {
        clearError(lastNameError);
      });

      emailInput.addEventListener('input', () => {
        clearError(emailError);
      });

      phoneInput.addEventListener('input', () => {
        clearError(phoneError);
      });

      roleSelect.addEventListener('change', () => {
        clearError(roleError);
        const role = roleSelect.value;
        
        // Show/hide fields based on role
        if (role === 'customer') {
          customerFields.classList.remove('hidden');
          trainerFields.classList.add('hidden');
          addressInput.required = true;
          specializationSelect.required = false;
          yearsOfExperienceInput.required = false;
        } else if (role === 'trainer') {
          customerFields.classList.add('hidden');
          trainerFields.classList.remove('hidden');
          addressInput.required = false;
          specializationSelect.required = true;
          yearsOfExperienceInput.required = true;
        } else {
          customerFields.classList.add('hidden');
          trainerFields.classList.add('hidden');
          addressInput.required = false;
          specializationSelect.required = false;
          yearsOfExperienceInput.required = false;
        }
        
        // Clear values when switching roles
        if (role !== 'customer') {
          addressInput.value = '';
        }
        if (role !== 'trainer') {
          specializationSelect.value = '';
          yearsOfExperienceInput.value = '';
        }
      });

      confirmPasswordInput.addEventListener('input', () => {
        clearError(confirmPasswordError);
        if (confirmPasswordInput.value && passwordInput.value) {
          if (confirmPasswordInput.value !== passwordInput.value) {
            showError(confirmPasswordError, 'Passwords do not match');
          } else {
            clearError(confirmPasswordError);
          }
        }
      });

      confirmPasswordInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          registerForm.dispatchEvent(new Event('submit'));
        }
      });

      document.getElementById("year").textContent = new Date().getFullYear().toString();
    </script>
  </body>
</html>
